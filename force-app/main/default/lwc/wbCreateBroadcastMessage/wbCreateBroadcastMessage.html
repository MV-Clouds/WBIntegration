<template>
    <template if:true={isNewBroadcastMessage}>
        <div class="main-container">
            <template if:true={isLoading}>
                <div class="spinner-overlay">
                    <lightning-spinner alternative-text="Loading" size="large"></lightning-spinner>
                </div>
            </template>

            <div class="main">
                <div class="heading">
                    <p>New Broadcast Message</p>
                </div>
                <div class="all-section">
                    <div class="left-section">
                        <div class="slds-form-element__control">
                            <lightning-input
                                onchange={search}
                                onfocus={showPickListOptions}
                                type="search"
                                value={selectedValue}
                            ></lightning-input>
                
                            <!-- Only display dropdown if there are search results -->
                            <div 
                                if:true={searchResults.length} 
                                class="slds-dropdown slds-dropdown_length-5 slds-dropdown_fluid"
                                role="listbox"
                            >
                                <ul class="slds-listbox slds-listbox_vertical" role="presentation">
                                    <template for:each={searchResults} for:item="searchResult">
                                        <li 
                                            key={searchResult.value} 
                                            data-value={searchResult.value} 
                                            role="presentation" 
                                            onclick={selectSearchResult} 
                                            class="slds-listbox__item"
                                        >
                                            <div 
                                                class="slds-media slds-listbox__option slds-listbox__option_plain slds-media_small" 
                                                role="option"
                                            >
                                                <span class="slds-media__body">
                                                    <span class="slds-truncate" title={searchResult.label}>
                                                        {searchResult.label}
                                                    </span>
                                                </span>
                                            </div>
                                        </li>
                                    </template>
                                </ul>
                            </div> 
                        </div>
                        <template if:true={selectedSearchResult}>
                            <div class="right-bottom">
                                <div class="PreviewmainWP">
                                    <div class="templateheadWP">
                                        <p class="templatetextWP"><b>Template Preview</b></p>
                                        <div class="PreviewtemplateWP">
                                            <div class="slds-box slds-theme_default chatWP-bubble">
                                            
                                                <template if:true={tempHeader}>
                                                    <div class="TextHeadingWP">
                                                        <lightning-formatted-rich-text value={tempHeader}></lightning-formatted-rich-text>
                                                    </div>
                                                </template>
                                                <template if:true={isImgSelected}>
                                                    <div>
                                                        <img src={filepreview} alt="File Preview" style="max-width: 100%; height: auto;" />
                                                    </div>
                                                </template>
                                                <div class="TextBodyWP">
                                                    <lightning-formatted-rich-text value={tempBody}></lightning-formatted-rich-text>
                                                </div>
                                    
                                                <div class="textfooterWP">
                                                    <p class="pfooterWP">{tempFooter}</p>
                                                </div>
                                                <div class="TextTimeWP">
                                                    <p class="timefooterWP">11:59</p>
                                                </div>
                                        
                                                <template if:true={buttonList}>
                                                    <template for:each={buttonList} for:item="button" for:index="index">
                                                        <hr key={button.id} class="separator-line" />
                                                        <div key={button.id} class="button-label-preview">
                                                            <p>{button.btntext}</p>
                                                        </div>
                                                    </template>
                                                </template>
                                            
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                        </template>
                    </div>
                    
                    <div class="vertical-line"></div> 
                    <div class="right-section">
                        <div class="right-heading">
                            <div class="slds-form-element__control">
                                <lightning-input
                                    onchange={searchGroup}
                                    onfocus={showBroadcastOption}
                                    type="search"
                                    value={bgSelectedValue}
                                ></lightning-input>
                    
                                <!-- Only display dropdown if there are search results -->
                                <div 
                                    if:true={bgsearchResults.length} 
                                    class="slds-dropdown slds-dropdown_length-5 slds-dropdown_fluid"
                                    role="listbox"
                                >
                                    <ul class="slds-listbox slds-listbox_vertical" role="presentation">
                                        <template for:each={bgsearchResults} for:item="searchResult">
                                            <li 
                                                key={searchResult.value} 
                                                data-value={searchResult.value} 
                                                data-record-id={searchResult.value} 
                                                role="presentation" 
                                                onclick={selectbgSearchResult} 
                                                class="slds-listbox__item"
                                            >
                                                <div 
                                                    class="slds-media slds-listbox__option slds-listbox__option_plain slds-media_small" 
                                                    role="option"
                                                >
                                                    <span class="slds-media__body">
                                                        <span class="slds-truncate" title={searchResult.label}>
                                                            {searchResult.label}
                                                        </span>
                                                    </span>
                                                </div>
                                            </li>
                                        </template>
                                    </ul>
                                </div> 
                            </div>
                            
                        </div>
                        <div class="members">
                            <div class="group-heading">
                                <p>Selected Members</p>
                            </div>
                            <div class="slds-pill_container">
                                <template if:true={selectedContacts.length}>
                                    <template for:each={selectedContacts} for:item="contact">
                                        <div class="show-bgGroup" key={contact.id} data-id={contact.id}>
                                            <p>{contact.label}</p>
                                        </div>
                                    </template>
                                </template>
                                <template if:false={selectedContacts.length}>
                                    <p class="no-member">No members selected.</p>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>
            
                <div class="buttons">
                    <button class="cancel-btn" onclick={cancelBroadcastMessage}>Cancel</button>
                    <button class="save-btn" onclick={scheduleBroadcastMessage}>Schedule</button>
                    <button class="save-btn" onclick={sendBroadcastMessage}>Send</button>
                </div>
            </div>
        </div>
    </template>
   
    <template if:true={isAllBroadcast}>
        <c-wb-manage-broadcast></c-wb-manage-broadcast>
    </template>
</template>

