<template>
    <div class="automation-container slds-box slds-theme_default">
        <div class="slds-p-vertical_medium slds-p-horizontal_large slds-text-heading_large header-background slds-text-color_inverse">
            {automation.name}
        </div>

        <lightning-layout class="slds-p-around_medium">

            <lightning-layout-item size="12" medium-device-size="3" padding="around-small">
                <p class="slds-text-title slds-m-bottom_small">Template Buttons:</p>
                <lightning-layout vertical-align="stretch" multiple-rows="true">
                    <template for:each={templateButtons} for:item="btn">
                        <lightning-layout-item key={btn.id} size="12" padding="slds-vertical-xx-small">
                             <button
                                class={btn.computedClass}
                                data-id={btn.id}
                                onclick={handleTemplateButtonClick}>
                                {btn.label}
                             </button>
                        </lightning-layout-item>
                    </template>
                </lightning-layout>
            </lightning-layout-item>

            <lightning-layout-item size="12" medium-device-size="9" padding="around-small">

                <lightning-layout>
                    <lightning-layout-item flexibility="grow">
                        <lightning-button-group>
                            <template if:false={isFlowTemplate}>
                                <lightning-button label="Send WhatsApp Template" value="whatsapp" onclick={handleActionChange}></lightning-button>
                                <lightning-button label="Send Email Template" value="email" onclick={handleActionChange}></lightning-button>
                            </template>
                            <template if:true={isFlowTemplate}>
                                <lightning-button label="Create Records" value="create" onclick={handleActionChange}></lightning-button>
                            </template>
                        </lightning-button-group>
                    </lightning-layout-item>
                </lightning-layout>

                <div class="slds-m-top_medium slds-box content-box">
                    <!-- WhatsApp View -->
                    <template if:true={isWhatsAppView}>
                        <lightning-layout vertical-align="end">
                            <lightning-layout-item flexibility="grow" padding="around-small">
                                <lightning-input
                                    label="Search Template"
                                    variant="label-hidden"
                                    placeholder="Search Template"
                                    type="search"
                                    value={searchTerm}
                                    onchange={handleSearchChange}>
                                </lightning-input>
                            </lightning-layout-item>
                        </lightning-layout>

                        <div class="slds-m-top_small scrollable-list">
                            <template for:each={filteredWhatsAppTemplates} for:item="template">
                                <div key={template.Id}
                                    class={template.computedClass}
                                    data-id={template.Id}
                                    onclick={handleTemplateSelect}>
                                    {template.Name}
                                </div>
                            </template>
                            <template if:false={hasFilteredTemplates}>
                                <div class="slds-text-align_center slds-p-vertical_medium slds-text-color_weak">
                                    No matching templates found.
                                </div>
                            </template>
                        </div>
                    </template>

                    <!-- Create Records View -->
                    <template if:true={isCreateView}>
                        <div class="slds-text-align_center slds-p-vertical_large">
                            <lightning-combobox
                                name="Object"
                                label="Object"
                                value={value}
                                placeholder="Select Object"
                                options={options}
                                onchange={handleChange}>
                            </lightning-combobox>
                        </div>
                    </template>

                    <!-- Email View -->
                    <template if:true={isEmailView}>
                        <lightning-layout vertical-align="end">
                            <lightning-layout-item flexibility="grow" padding="around-small">
                                <lightning-input
                                    label="Search Template"
                                    variant="label-hidden"
                                    placeholder="Search Template"
                                    type="search"
                                    value={searchTerm}
                                    onchange={handleSearchChange}>
                                </lightning-input>
                            </lightning-layout-item>
                        </lightning-layout>

                        <div class="slds-m-top_small scrollable-list">
                            <template for:each={filteredWhatsAppTemplates} for:item="template">
                                <div key={template.Id}
                                    class={template.computedClass}
                                    data-id={template.Id}
                                    onclick={handleTemplateSelect}>
                                    {template.Name}
                                </div>
                            </template>
                            <template if:false={hasFilteredTemplates}>
                                <div class="slds-text-align_center slds-p-vertical_medium slds-text-color_weak">
                                    No matching templates found.
                                </div>
                            </template>
                        </div>
                    </template>
                </div>

            </lightning-layout-item>

        </lightning-layout>

        <div class="slds-p-around_medium slds-text-align_right footer-border">
             <lightning-button
                label="Cancel"
                variant="neutral"
                onclick={handleCancel}
                class="slds-m-right_small">
            </lightning-button>
            <lightning-button
                label="Save"
                variant="brand"
                onclick={handleSave}>
            </lightning-button>
        </div>
    </div>
</template>